# vulnerability.py
from home_net_analyzer.vulnerability_utils.http import check_http_vulnerability
from home_net_analyzer.vulnerability_utils.ssh import check_ssh_vulnerability
from home_net_analyzer.vulnerability_utils.ftp import check_ftp_vulnerability
from home_net_analyzer.vulnerability_utils.smtp import check_smtp_vulnerability
from home_net_analyzer.vulnerability_utils.dns import check_dns_vulnerability
from home_net_analyzer.vulnerability_utils.file_sharing import check_file_sharing_vulnerability
from home_net_analyzer.vulnerability_utils.webapp import check_webapp_vulnerability


from home_net_analyzer.constants import WEBAPP_PORTS


def scan_vulnerabilities(ip_address, open_ports):
    vulnerabilities = {}
    for port in open_ports:
        print('PORT', port)
        if port == 22:  # SSH
            vulnerabilities[port] = check_ssh_vulnerability(ip_address)
        elif port in [80, 443]:  # HTTP/HTTPS
            vulnerabilities[port] = check_http_vulnerability(ip_address, port)
        elif port == 21:  # FTP
            vulnerabilities[port] = check_ftp_vulnerability(ip_address)
        elif port == 25 or port == 587:  # SMTP
            vulnerabilities[port] = check_smtp_vulnerability(ip_address)
        elif port == 53:  # DNS
            vulnerabilities[port] = check_dns_vulnerability(ip_address)
        elif port in [139, 445]:  # File sharing (SMB)
            vulnerabilities[port] = check_file_sharing_vulnerability(
                ip_address, port)
        elif port in WEBAPP_PORTS:  # See constants.py
            vulnerabilities[port] = check_webapp_vulnerability(
                ip_address, port)

    return vulnerabilities
